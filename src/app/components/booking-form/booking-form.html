<div class="booking-container">
  <!-- Hero Section -->
  <div class="hero-section">
    <h1 class="hero-title">Book Your Journey</h1>
    <p class="hero-subtitle">Fast, comfortable, sustainable transportation</p>
  </div>

  <!-- Success/Error Messages -->
  <div *ngIf="successMessage" class="message success-message">
    {{ successMessage }}
  </div>
  <div *ngIf="errorMessage" class="message error-message">
    {{ errorMessage }}
  </div>

  <!-- Wallet Preview -->
  <div class="wallet-preview card" style="margin-bottom:12px; display:flex; align-items:center; justify-content:space-between; padding:12px;">
    <div>
      <div style="font-size:12px; color:#ffffff">Wallet Balance</div>
      <div style="font-weight:700; font-size:18px; color:#ffffff">EGP {{ walletService.balance() | number:'1.2-2' }}</div>
    </div>
    <div style="display:flex; gap:8px;">
      <button type="button" class="btn" (click)="refreshBalance()">Refresh</button>
      <button type="button" class="btn btn-primary" (click)="goToWallet()">Top Up</button>
    </div>
  </div>

  <!-- Low balance warning (shows when route selected and balance insufficient) -->
  <div *ngIf="!hasSufficientBalance() && bookingForm.get('fromStation')?.value && bookingForm.get('toStation')?.value"
       class="warning" style="margin-bottom:12px; padding:10px; border-radius:8px; background:#fff3f2; color:#9f1239;">
    Insufficient balance: you need EGP {{ shortageAmount() }} more to book this ticket. <button type="button" class="link" (click)="goToWallet()">Top up now</button>
  </div>

  <!-- Booking Form Card -->
  <div class="booking-card">
    <div class="card-header">
      <svg class="ticket-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <rect x="2" y="7" width="20" height="10" rx="2" stroke-width="2"/>
        <line x1="2" y1="12" x2="22" y2="12" stroke-width="2" stroke-dasharray="2 2"/>
      </svg>
      <h2 class="card-title">Book Your Journey</h2>
    </div>

    <form [formGroup]="bookingForm" (ngSubmit)="onSubmit()">
      <!-- Category Selection -->
      <div class="form-row">
        <div class="form-group full-width">
          <label class="form-label">Transport Type</label>
          <select
            class="form-control"
            formControlName="category"
            [class.invalid]="bookingForm.get('category')?.invalid && bookingForm.get('category')?.touched">
            <option value="" disabled>Select transport type</option>
            <option *ngFor="let cat of categories" [value]="cat.value">
              {{ cat.label }}
            </option>
          </select>
        </div>
      </div>

      <!-- From and To Row -->
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">From</label>
          <select
            class="form-control"
            formControlName="fromStation"
            [class.invalid]="bookingForm.get('fromStation')?.invalid && bookingForm.get('fromStation')?.touched">
            <option value="" disabled selected>Select departure station</option>
            <option *ngFor="let station of stations" [value]="station.name">
              {{ station.name }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">To</label>
          <select
            class="form-control"
            formControlName="toStation"
            [class.invalid]="bookingForm.get('toStation')?.invalid && bookingForm.get('toStation')?.touched">
            <option value="" disabled selected>Select arrival station</option>
            <option *ngFor="let station of stations" [value]="station.name">
              {{ station.name }}
            </option>
          </select>
        </div>
      </div>

      <!-- Passengers and Description Row -->
      <div class="form-row">
        <div class="form-group">
          <label class="form-label">Passengers</label>
          <select class="form-control" formControlName="passengers">
            <option *ngFor="let num of passengers" [value]="num">
              {{ num }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Description (Optional)</label>
          <input
            type="text"
            class="form-control"
            formControlName="description"
            placeholder="Any special requests">
        </div>
      </div>

      <!-- Submit Button -->
      <button type="submit" class="submit-button" [disabled]="bookingForm.invalid || isLoading || !hasSufficientBalance()">
        <svg *ngIf="!isLoading" class="button-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <rect x="2" y="7" width="20" height="10" rx="2" stroke-width="2"/>
          <line x1="2" y1="12" x2="22" y2="12" stroke-width="2" stroke-dasharray="2 2"/>
        </svg>
        <span *ngIf="isLoading" class="spinner"></span>
        {{ isLoading ? 'Booking...' : 'Book Ticket - ' + getTotalPrice() + ' EGP' }}
      </button>
    </form>
  </div>

  <!-- Features Section -->
  <div class="features-section">
    <div class="feature-card">
      <div class="feature-icon">✓</div>
      <h3 class="feature-title">Instant Confirmation</h3>
      <p class="feature-description">Get your ticket immediately</p>
    </div>

    <div class="feature-card">
      <div class="feature-icon">✓</div>
      <h3 class="feature-title">Free Cancellation</h3>
      <p class="feature-description">Cancel up to 2 hours before</p>
    </div>

    <div class="feature-card">
      <div class="feature-icon">✓</div>
      <h3 class="feature-title">Eco-Friendly</h3>
      <p class="feature-description">100% electric transport</p>
    </div>
  </div>
</div>
